<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Psmm : PSeudo-Mutable Message for Actors">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Psmm</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/cuzfrog/psmm">View on GitHub</a>

          <h1 id="project_title">Psmm</h1>
          <h2 id="project_tagline">PSeudo-Mutable Message for Actors</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/cuzfrog/psmm/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/cuzfrog/psmm/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a id="project-developing-progress" class="anchor" href="#project-developing-progress" aria-hidden="true"><span class="octicon octicon-link"></span></a>Project developing progress:</h2>

<p>General tests passed. Now I'm working hard on refactoring and refining. Hope those of you who're interested could contribute to this project.</p>

<h2>
<a id="what-is-psmm" class="anchor" href="#what-is-psmm" aria-hidden="true"><span class="octicon octicon-link"></span></a>What is Psmm?</h2>

<p>Psmm is abbreviation for PSeudo-Mutable Message. It's a java library to easy implement immutable message for <a href="https://en.wikipedia.org/wiki/Actor_model">actors</a>.</p>

<p>Messages are passed on from actors to actors, thus probably shared by threads. <a href="http://akka.io/">Akka</a> document clearly states that messages must be immutable, otherwise Akka actors can't ensure eliminating evils of low level java concurrency. But for writing immutable object, you need to be careful about things. In this note, I wrote Psmm, so we can easily generate immutable message.</p>

<h2>
<a id="get-started" class="anchor" href="#get-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get started:</h2>

<p>First initiate PsmmSystem(create factories and so on):</p>

<div class="highlight highlight-java"><pre>        <span class="pl-smi">PsmmSystem</span><span class="pl-k">.</span>initiate(); <span class="pl-c">//only invoke once in your main thread</span></pre></div>

<p>Create a new message</p>

<div class="highlight highlight-java"><pre>        <span class="pl-smi">UMessage</span> message <span class="pl-k">=</span> 
                <span class="pl-smi">Messages</span><span class="pl-k">.</span>create() <span class="pl-c">//create a raw message</span>
                .set(key1, value1) 
                .set(key2, value2) <span class="pl-c">//add some data</span>
                <span class="pl-c1">...</span>
                .cook(); </pre></div>

<p>Modify an existed one:</p>

<div class="highlight highlight-java"><pre>        <span class="pl-smi">UMessage</span> messageAfter <span class="pl-k">=</span> 
                messageBefore 
                .set(key1, value1) 
                .set(key2, value2) <span class="pl-c">//add or reset some data</span>
                <span class="pl-c1">...</span>
                .cook(); </pre></div>

<p>Code example:</p>

<div class="highlight highlight-java"><pre><span class="pl-k">import</span> <span class="pl-smi">cuz.my.psmm.Messages</span>;
<span class="pl-k">import</span> <span class="pl-smi">cuz.my.psmm.PsmmSystem</span>;
<span class="pl-k">import</span> <span class="pl-smi">cuz.my.psmm.UMessage</span>;

<span class="pl-k">class</span> <span class="pl-en">SimpleTest</span> {

    <span class="pl-k">public</span> <span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">main</span>(<span class="pl-k">String</span>[] <span class="pl-v">args</span>) {
        <span class="pl-c">// TODO Auto-generated method stub</span>

        <span class="pl-smi">PsmmSystem</span><span class="pl-k">.</span>initiate(); <span class="pl-c">//only invoke once in your main thread</span>


        <span class="pl-c">//create a new message:</span>
        <span class="pl-smi">String</span> key1 <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>int1<span class="pl-pds">"</span></span>;
        <span class="pl-smi">String</span> key2 <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>int2<span class="pl-pds">"</span></span>;
        <span class="pl-smi">String</span> key3 <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>str1<span class="pl-pds">"</span></span>;
        <span class="pl-smi">UMessage</span> message1 <span class="pl-k">=</span> 
                <span class="pl-smi">Messages</span><span class="pl-k">.</span>create() <span class="pl-c">//create a raw message</span>
                .set(key1, <span class="pl-c1">2</span>)
                .set(key2, <span class="pl-c1">122</span>)
                .set(key3, <span class="pl-s"><span class="pl-pds">"</span>this is string<span class="pl-pds">"</span></span>) <span class="pl-c">//add some data</span>
                .cook(); <span class="pl-c">//without cook() compile time error.</span>
        <span class="pl-c">//after passed to another actor, fetch data:</span>
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(message1<span class="pl-k">.</span>get(key1) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span> <span class="pl-k">+</span> message1<span class="pl-k">.</span>get(key2) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span> <span class="pl-k">+</span> message1<span class="pl-k">.</span>get(key3));
        <span class="pl-c">//result: 2|122|this is string</span>

        <span class="pl-smi">String</span> key4 <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>double1<span class="pl-pds">"</span></span>;
        <span class="pl-c">//"modify" last message, reset some data, add some new data:</span>
        <span class="pl-smi">UMessage</span> message2 <span class="pl-k">=</span>
                message1
                .set(key2, <span class="pl-c1">122</span>)
                .set(key3, <span class="pl-s"><span class="pl-pds">"</span>this is another string<span class="pl-pds">"</span></span>)
                .set(key4, <span class="pl-c1">568.3d</span>)
                .cook();
        <span class="pl-c">//after passed to another actor, fetch data:</span>
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println(message2<span class="pl-k">.</span>get(key1) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span> <span class="pl-k">+</span> message2<span class="pl-k">.</span>get(key2) <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span> <span class="pl-k">+</span> message2<span class="pl-k">.</span>get(key3)<span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>|<span class="pl-pds">"</span></span> <span class="pl-k">+</span> message2<span class="pl-k">.</span>get(key4));
        <span class="pl-c">//result: 2|122|this is another string|568.3</span>
    }

}</pre></div>

<h2>
<a id="document" class="anchor" href="#document" aria-hidden="true"><span class="octicon octicon-link"></span></a>Document:</h2>

<h4>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h4>

<p>Psmm messages take advantage of Decorator Pattern. Every message has a reference of preceded message. For newly created message, PsmmFactory puts a RootMessage in it. After a message has been set("modified"), factory create a new message decorating the old one, of course, with new data. Therefore, you can access psmm as if it's mutable.</p>

<p>Psmm includes different *Styles of messages standing for different structures.</p>

<ol>
<li>Linked(default): decorate old message when every setting. When getting data, first check keys in newest message, then the last one. This is the fast way to create new object, because when you create it, you don't care about the old data.But when the chain is long, it'll be slower to fetch some data. It also provides a way to regress a message: shell the outermost message, return the inner one.</li>
<li>Flat: no decoration, read data from old message and merge them into new message.</li>
<li>Typed: need to explicitly indicate Generic parameter Type. Thus gives flexibility to put user defined data object into message.</li>
<li>Untyped: only takes basic immutable object, such as String, Integer etc. When retrieving data, need to cast.</li>
<li>Cached: references of messages created are stored in a pool. Why not reuse immutable object? (<em>But there might be a pitfall, is it really necessary to cache small object in modern JVM? I'm working on this issue and refactoring this algorithm. Maybe you can tell me more</em>.)</li>
<li>Uncached: Oppose to cached.
####Performance:
I've prepared some performance test data, and I'll upload them, and explain in detail.</li>
</ol>

<p>It's very important to know that generating message, in most cases, only takes a fraction of application time. It's really not necessary to worry about their performance. When I did micro-benchmark test, yeah, disparity could be huge. However, when I did actual actor interaction test, performances are in the same scale.</p>

<h4>
<a id="nomenclature" class="anchor" href="#nomenclature" aria-hidden="true"><span class="octicon octicon-link"></span></a>Nomenclature:</h4>

<p>*Style is used for distinguishing from Parameter Type.</p>

<h4>
<a id="javadoc" class="anchor" href="#javadoc" aria-hidden="true"><span class="octicon octicon-link"></span></a>Javadoc:</h4>

<p>I have written complete javadoc, and I'll  upload it.</p>

<h2>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support or Contact</h2>

<p>Authors:Cause Chung (<a href="https://github.com/cuzfrog" class="user-mention">@cuzfrog</a>)</p>

<p>Any problem, please hit on GitHub or mail me: <a href="mailto:cuzfrog@139.com">cuzfrog@139.com</a> /cuzfrog@gamil.com</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Psmm maintained by <a href="https://github.com/cuzfrog">cuzfrog</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-67181335-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
